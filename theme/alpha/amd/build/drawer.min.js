/**
 * Contain the logic for a drawer.
 *
 * @module theme_alpha/drawer
 * @copyright  2016 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/ define(["jquery","core/custom_interaction_events","core/log","core/pubsub","core/aria"],function(e,t,a,r,n){var i={TOGGLE_REGION:'[data-region="drawer-toggle"]',TOGGLE_ACTION:'[data-action="toggle-drawer"]',TOGGLE_TARGET:"aria-controls",TOGGLE_SIDE:"left",BODY:"body",SECTION:'.list-group-item[href*="#section-"]',DRAWER:"#nav-drawer"},s=768>e(document).width(),o=function(){e(i.TOGGLE_REGION).length||a.debug("Page is missing a drawer region"),e(i.TOGGLE_ACTION).length||a.debug("Page is missing a drawer toggle link"),e(i.TOGGLE_REGION).each((function(t,a){var r=e(a).find(i.TOGGLE_ACTION),n=r.attr("aria-controls");e(document.getElementById(n));var o="false"==r.attr("aria-expanded"),l=r.attr("data-side"),d=e(i.BODY),c=r.attr("data-preference");s&&M.util.set_user_preference(c,"false"),o?r.attr("aria-expanded","false"):(d.addClass("drawer-open-"+l),r.attr("aria-expanded","true"))}).bind(this)),this.registerEventListeners(),s&&this.closeAll()};return o.prototype.closeAll=function(){e(i.TOGGLE_REGION).each(function(t,a){var r=e(a).find(i.TOGGLE_ACTION),o=r.attr("data-side"),l=e(i.BODY),d=r.attr("aria-controls"),c=e(document.getElementById(d)),u=r.attr("data-preference");r.attr("aria-expanded","false"),l.removeClass("drawer-open-"+o),n.hide(c.get()),c.addClass("closed"),s||M.util.set_user_preference(u,"false")})},o.prototype.toggleDrawer=function(t){var a=e(t.target).closest("[data-action=toggle-drawer]"),o=a.attr("aria-controls"),l=e(document.getElementById(o)),d=e(i.BODY),c=a.attr("data-side"),u=a.attr("data-preference");s&&M.util.set_user_preference(u,"false"),d.addClass("drawer-ease");var g="true"==a.attr("aria-expanded");g?(d.removeClass("drawer-open-"+c),a.attr("aria-expanded","false"),l.addClass("closed").delay(500).queue(function(){e(this).hasClass("closed")&&n.hide(this),e(this).dequeue()}),s||M.util.set_user_preference(u,"false")):(a.attr("aria-expanded","true"),n.unhide(l.get()),l.focus(),d.addClass("drawer-open-"+c),l.removeClass("closed"),s||M.util.set_user_preference(u,"true")),r.publish("nav-drawer-toggle-start",g)},o.prototype.preventPageScroll=function(t){var a=t.wheelDelta||t.originalEvent&&t.originalEvent.wheelDelta||-t.originalEvent.detail,r=this.scrollTop+e(this).outerHeight()-this.scrollHeight>=0,n=this.scrollTop<=0;(a<0&&r||a>0&&n)&&t.preventDefault()},o.prototype.registerEventListeners=function(){e(i.TOGGLE_ACTION).each((function(a,r){t.define(e(r),[t.events.activate]),e(r).on(t.events.activate,(function(e,t){this.toggleDrawer(t.originalEvent),t.originalEvent.preventDefault()}).bind(this))}).bind(this)),e(i.SECTION).click((function(){s&&this.closeAll()}).bind(this)),e(i.DRAWER).on("webkitTransitionEnd msTransitionEnd transitionend",function(t){var a=!!e(t.target).closest(i.DRAWER).attr("aria-hidden");r.publish("nav-drawer-toggle-end",a)})},{init:function(){return new o}}});